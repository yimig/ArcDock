[TOC]



## 面向用户

### 概述

欢迎使用单据生成工具，本程序可以根据模板生成样式统一的单页图文媒体，您可以将其保存为图片文件、网页或者直接将其打印。通过本教程，您可以了解以下基本操作：

- 程序的典型使用场景
- 数据填写方式
- 生成结果
- 模板设置
- 全局配置
- 同步设置

#### 术语

文档中出现的部分术语可能造成歧义，在此先行定义：

- 模板：**由管理员先行编写好的样式结构，包含排版、预置的图文、和对应预留项的配置。**其宿主为一个html网页文件，遵循网页xml解析标准。**模板还可以加载资源**，此时模板就不止一个文件。

- 图文媒体：由于本工具主要功能围绕打印展开，一个图文媒体指的是**一个填充了对应数据的模板**，或者简单理解为“打印出的媒体”。若无特殊说明，软件中所有的“新建”指的都是新建一个图文媒体。
- 预留值：有时也称为配置项，**是指的模板中可后期插入数据的部分**，预留值有多个属性，其中最重要的是**ID**，程序将动态地查询模板中的ID并替换其内容。
- 全局设置：存储在应用配置文件中，将应用于所有模板的设置，无法分模板独立设定。
- 模板设置：存储在模板中，只应用于当前模板。

#### 权限

因用户只使用用户界面进行操作，很多高级用法难以通过图形化实现，亦不建议普通用户修改这部分内容，包括但不限于：

- 创建模板
- 新增、删除模板配置项
- 修改模板样式
- 修改文本分析脚本

如果您有修改上述功能的需求，请联系您的系统管理员。

不过，通用配置仍对普通用户开放，您可以根据需要去定制以下内容：

- 修改全局配置：设置启动约束条件、切换打印API等。
- 修改模板内置预设：智能联想内容、智能补全内容、默认值、约束条件等。
- 发送、接收配置。

修改这些配置较为安全，不会对业务造成严重影响。

#### 典型使用场景

1. 单页填写打印

   数据可由手动、文本解析、CLI获取。

   此种方式适合打印定制化的**票据、凭条、优惠券、入场券、页签、瓶签、腕带、名片、徽章等**。

2. 循环打印

   打印多张相同内容的媒体，数据可由手动、文本解析、CLI获取。

   当`单页填写打印`需要**多张副本**时，可以使用该方式打印。

3. 文件数据导入为对象（JSON）

   **数据存储在Excel中（仅支持.xlsx文件）**，将文件全部数据导入模板，得到**单张**包含多个数据的图文媒体。

   此种填写方式适合打印定制化的**展示板、名单、宣传栏等**。

4. 文件数据导入为文本（批量打印）

   **数据存储在Excel中（仅支持.xlsx文件）**，每次将文件中的一行数据导入模板，得到**多张**包含单条数据的图文媒体。

   此种填写方式适合批量打印给定内容，通常为**团体**的凭条、入场券等。

5. 混合

   您可以将JSON保存在Excel中，通过批量打印该Excel得到上述第三条与第四条的叠加效果。

   此种填写方式适合打印定制化的**数据图表、幻灯片、简单手册等**。

#### 数据填写方式

1. 手动填写

   数据通过用户手动填写获取，可以使用`智能文本框`来联想填写内容，增加填写效率。

   ![使用智能补全增加手动填写效率](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428144611943.png)

2. 文本解析

   数据由文本解析获取，数据源通常来自其他软件，需要其文本可被复制。

   ![文本解析，具体提取方式可与管理员讨论后添加](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428144811316.png)

3. 来自文件

   可选择将文件数据导入为对象（JSON）或文件数据导入为文本（批量打印）

   ![使用Excel文件内容添加到媒体](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428145055408.png)

4. CLI

   使用CLI界面通过命令传输数据。此方式一般用于三方软件调用。

   ![image-20230428145737941](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428145737941.png)

### 使用方法

#### 主页构成

![image-20230428151100970](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428151100970.png)

#####  ① 菜单栏

菜单栏有三个独立菜单组成，分别为`文件`、`设置`、`关于`，其中：

- 文件

  - 新建：新建一个图文媒体，旧媒体不会保存。

  - 导入文件：读取指定Excel并按行批量打印，打印前可以选择列名和预留值的对应关系。

  - 导出为

    - HTML网页：将当前图文媒体导出为HTML网页

    - JPG图片：将当前图文媒体导出为JPG图片

      也可以通过系统内置PDF打印机导出为PDF，软件内不再提供。

  - 打印

    - 打印单份：打印一份图文媒体
    - 打印多份：打印多份图文媒体（并非所有打印API都支持系统内多份打印，详情请参考“打印API对比”章节）

- 设置

  - 全局设置：修改全局设置
  - 模板设置：修改模板设置（并非所有模板设置都支持在系统内修改，如有高级需求请联系管理员）
  - 同步配置
    - 发送当前配置：启动Socket服务器并发送当前配置
    - 接收配置：接收其他客户端发送的配置

- 关于

  - 软件信息：软件版本、依赖包、更新说明等信息
  - 使用说明：打开说明文档

##### ② 工具栏

目前提供的工具从左到右依次为`新建`、`文本分析`、`批量导入`、`查看历史`、`打印`、`批量打印`

![image-20230428161640047](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428161640047.png)

- 新建：（同`文件`→`新建`）新建一个图文媒体，旧媒体不会保存。
- 文本分析：调出文本分析输入窗口。
- 批量导入：（同`文件`→`导入文件`）读取指定Excel并按行批量打印，打印前可以选择列名和预留值的对应关系。
- 查看历史：调出打印历史窗口。
- 打印单份：（同`文件`→`打印`→`打印单份`）打印一份图文媒体。
- 打印多份：（同`文件`→`打印`→`打印多份`）打印多份图文媒体（并非所有打印API都支持系统内多份打印，详情请参考“打印API对比”章节）

##### ③ 切换模板下拉列表

在此可切换成功解析的模板，模板文件位于程序所在目录的`template`目录中，应以html后缀名结尾。

##### ④ 数据采集区

在此可以手动录入预留值数据。根据预留值配置不同，文本框有以下几种形式：

- 普通文本框：

  ![image-20230428162635414](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428162635414.png)

  由标题和内容组成的普通文本框，不可手动换行。

- 多行文本框

  ![image-20230428164455876](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428164455876.png)

  普通文本框的可换行版本，但是是否真正可在模板中体现为多行显示还需要模板样式控制。

- 智能文本框

  ![image-20230428163128770](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428163128770.png)

  智能文本框可在用户输入内容拼音头或者一部分内容时给出提示，提高输入效率。有两种版本：

  - 单框文本补全：只是在用户输入时给出补全提示，辅助用户完成本预留值的填写。
  - 多框联动补全：在用户输入的内容命中提示、或者选择给出的提示时，根据内容也改变其他文本框的值。

  两种智能文本框提示内容和行为都可以在模板配置中修改，详情请见“模板配置”章节。

- JSON对象

  ![image-20230428164532459](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428164532459.png)

  由标题、内容、导入文件按钮组成，用户可以选择点击`导入文件`按钮选择Excel文件生成JSON对象，也可以手动编写JSON对象。

##### ⑤ 快捷动作区

提供两个常用快捷操作：`新建`和`打印`（单份），功能与`文件`→`新建`和`文件`→`打印`→`打印单份`相同。

##### ⑥ 预览区

预览数据填充的效果，一般在切换模板、数据填充后进行刷新，若未进行刷新，可以使用预览区工具栏的`强制刷新`触发强制刷新。

> 根据打印API不同，预览效果可能与实际打印效果不同，详情参见“打印API对比”章节。

##### 	⑦ 预览区工具栏

预览区工具栏从左到右依次为`强制刷新`、`放大`、`缩小`、`控制台`。

![image-20230428165318964](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230428165318964.png)

- 强制刷新：强制刷新预览区的页面。
- 放大：放大当前预览区页面，**仅放大预览效果，打印时使用模板配置**。
- 缩小：缩小当前预览区页面，**仅缩小预览效果，打印时使用模板配置**。
- 控制台：打开预览区页面的控制台，一般由管理员调试时使用。

#### 工作流程

以下使用“食品标签”作为示例，展示了几种典型使用场景。

##### 手动填写

1. 选择正确的模板

   ![image-20230504092433042](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504092433042.png)

2. 在左侧数据采集区输入数据

   ![image-20230504092652063](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504092652063.png)

3. 在预览区中确认排版无误后，点击**工具栏**中的`打印`按钮或**快捷动作区**的`打印`按钮即可打印当前图文媒体。

   ![image-20230504093000681](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504093000681.png)

4. 打印完毕后，点击**工具栏**中的`新建`或者**快捷动作区**的`新建`即可清空填入数据。

   注意：因为工具栏中的按钮较为密集，容易误操作清空内容，故工具栏中的新建功能会请求用户确认后才清空内容。

   ![image-20230504093248936](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504093248936.png)

##### 文本解析

> 注意：文本解析功能需要管理员事先进行配置，如果目前文本解析无法达到预期效果，请联系管理员重新配置。

1. 选择正确的模板

   ![image-20230504092433042](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504092433042.png)

2. 点击**工具栏**中的`文本分析`按钮

   ![image-20230504095355377](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504095355377.png)

3. 在弹出的窗口中粘贴来自其他系统的文本，之后点击按钮”分析“，即可填充模板数据

   ![image-20230504095931621](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504095931621.png)

4. 在预览区中确认排版无误后，点击**工具栏**中的`打印`按钮或**快捷动作区**的`打印`按钮即可打印当前图文媒体。

   ![image-20230504093000681](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504093000681.png)

5. 打印完毕后，点击**工具栏**中的`新建`或者**快捷动作区**的`新建`即可清空填入数据。

   注意：因为工具栏中的按钮较为密集，容易误操作清空内容，故工具栏中的新建功能会请求用户确认后才清空内容。

   ![image-20230504093248936](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504093248936.png)

##### 文件数据导入

> 注意：并非所有的模板都支持文件数据导入，如需定制，请联系管理员。

1. 选择正确的模板

   ![image-20230504100136029](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504100136029.png)

2. 在支持数据导入的预留值右侧点击“导入文件”

   ![image-20230504100415585](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504100415585.png)

3. 在弹出窗口中点击“选择文件”

   ![image-20230504100520224](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504100520224.png)

4. 选择需要导入的文件，目前仅支持导入**xlsx**格式的文件。

   ![image-20230504100649382](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504100649382.png)

   在该示例中，Excel文件“大麻花营养成分表.xlsx”的内容如下：

   ![image-20230504105034106](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504105034106.png)

   文件的第一行将作为列名存储行，其数据将被解析为列名，请不要在第一行存储需要填充的数据。

5. 确定导入的参数与文件中列名的对应关系，**默认将顺序对应**，若对应不正确可以点击下拉菜单手动指定。

   ![image-20230504101126681](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504101126681.png)

   

6. 确认无误后点击右下角“确定”按钮，文件数据将被转换为JSON字符串填充入数据，根据模板内置规则渲染排版。

   ![image-20230504101325432](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504101325432.png)

7. 填充剩余内容填充完毕后，在预览区中确认排版无误，点击**工具栏**中的`打印`按钮或**快捷动作区**的`打印`按钮即可打印当前图文媒体。

   ![image-20230504101558171](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504101558171.png)

8. 打印完毕后，点击**工具栏**中的`新建`或者**快捷动作区**的`新建`即可清空填入数据。

   注意：因为工具栏中的按钮较为密集，容易误操作清空内容，故工具栏中的新建功能会请求用户确认后才清空内容。

   ![image-20230504101710212](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504101710212.png)

##### 批量打印

1. 选择正确的模板

   ![image-20230504092433042](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504092433042.png)

2. 在菜单栏选择`文件`→`导入文件`

   ![image-20230504103326471](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504103326471.png)

3. 在弹出窗口中点击“选择文件”

   ![image-20230504100520224](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504100520224.png)

4. 选择需要导入的文件，目前仅支持导入**xlsx**格式的文件。

   ![image-20230504103501953](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504103501953.png)

   在该示例中，Excel文件“产品标签.xlsx”的内容如下：

   ![image-20230504103541669](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504103541669.png)

   文件的第一行将作为列名存储行，其数据将被解析为列名，请不要在第一行存储需要填充的数据。

5. 确定导入的参数与文件中列名的对应关系，**默认将顺序对应**，若对应不正确可以点击下拉菜单手动指定。

   ![image-20230504103828769](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504103828769.png)

6. 点击右下角”确定“，程序将读取文件除标题行外的第一行数据填充入模板，用户在预览框预览效果无误后点击”确认“按钮，系统将按行批量填充模板并打印。

   ![image-20230504103906649](D:\Projects\VS_Projects\ArcDock\ArcDock\help\assets\image-20230504103906649.png)

   

   

### 配置指南

#### 全局配置

##### 模板预设规则

模板预设规则是存储在模板中对于各预留值的控制规则，匹配方式为**正则表达式**，**只有当匹配通过时才允许进行打印**。但是，有时规则较旧并没有适配新场景，就无法进行打印，**为了处理这种情况，可以在全局配置中临时禁用模板预设规则，此时任何数据都可打印。**

模板预设规则也可以通过模板配置进行修改，详情请见“模板配置”章节。

##### 打印API对比

由于各打印接口对于打印功能的支持情况不同，有时需要根据情况更改打印API，以下为各打印API的对比：

- PrintDocument API

  原理：将目前的视口截图后直接打印

  优势：排版效果与预览效果相同，支持静默打印

  劣势：系统原生接口打印照片时文本不清晰，打印效果一般

- CEF Print API

  原理：调用CEF内置的print()函数

  优势：排版效果与预览效果相同

  劣势：不支持静默打印，每次点击打印都需要选择打印机

- C-Lodop API

  原理：在CEF中注入CLodop接口打印函数

  优势：东华系统内置 了C-Lodop 打印接口，可以直接调用

  劣势：没安装东华系统的电脑需要手动安装C-Lodop接口，并且接口使用IE渲染打印结果，打印效果可能与预览效果不同

- PDFtoPrinter API

  原理：先使用CEF内置的方法将视口保存为PDF文件，再使用PDFtoPrinter 库的方法打印PDF

  优势：排版效果与预览效果相同，支持静默打印

  劣势：转储PDF文件可能比较慢

- Spire.Pdf API

  原理：先使用CEF内置的方法将视口保存为PDF文件，再使用Spire.Pdf 库的方法打印PDF

  优势：排版效果与预览效果相同，支持静默打印

  劣势：转储PDF文件可能比较慢，Spire.Pdf是商业库，免费版不能解析超过10页的PDF文件

##### API 支持情况一览表

| API               | 打印效果 | 静默打印 | 预览效果 | 指定打印机 | 多页打印 |          打印纸张规格单位          |
| ----------------- | :------: | :------: | :------: | :--------: | :------: | :--------------------------------: |
| PrintDocument API |   一般   |    √     |    √     |     √      |    √     |        Pixel(Width/Height)         |
| CEF Print API     |   最好   |    ×     |    √     |     ×      |    ×     |     Pixel(Html Meta Viewport)      |
| C-Lodop API       |   最好   |    √     |    ×     |     ×      |    ×     |     Pixel(Html Meta Viewport)      |
| PDFtoPrinter API  |    好    |    √     |    √     |     √      |    √     | CentiMetre(PrintWidth/PrintHeight) |
| Spire.Pdf API     |    好    |    √     |    √     |     √      |    √     | CentiMetre(PrintWidth/PrintHeight) |

##### 推荐接口顺序

> PDFtoPrinter API > CEF Print API > Spire.Pdf API > C-Lodop API > PrintDocument API

#### 模板配置

#### 同步配置

##### 发送配置

##### 接受配置

### 常见问题



## 面向维护人员

```
ArcDock [--silent][--template file_name] --args json_string
```



## 面向开发人员

